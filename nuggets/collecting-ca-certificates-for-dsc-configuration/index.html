<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.11.2 by Michael Rose
  Copyright 2013-2018 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE.txt
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>Collecting CA Certificates for DSC Configuration - PowerShell Journey</title>
<meta name="description" content="Best practice is to use individual certificates for each Node for DSC. While you can use auto enrollment, getting the certificates to where the MOF are build can be a problem. This is one solution">



<meta property="og:type" content="article">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="PowerShell Journey">
<meta property="og:title" content="Collecting CA Certificates for DSC Configuration">
<meta property="og:url" content="https://www.bladefirelight.com/nuggets/collecting-ca-certificates-for-dsc-configuration/">


  <meta property="og:description" content="Best practice is to use individual certificates for each Node for DSC. While you can use auto enrollment, getting the certificates to where the MOF are build can be a problem. This is one solution">





  <meta name="twitter:site" content="@BladeFireLight">
  <meta name="twitter:title" content="Collecting CA Certificates for DSC Configuration">
  <meta name="twitter:description" content="Best practice is to use individual certificates for each Node for DSC. While you can use auto enrollment, getting the certificates to where the MOF are build can be a problem. This is one solution">
  <meta name="twitter:url" content="https://www.bladefirelight.com/nuggets/collecting-ca-certificates-for-dsc-configuration/">

  
    <meta name="twitter:card" content="summary">
    
  

  



  <meta property="article:published_time" content="2017-04-21T00:00:00-05:00">





  

  


<link rel="canonical" href="https://www.bladefirelight.com/nuggets/collecting-ca-certificates-for-dsc-configuration/">







  <script type="application/ld+json">
    {
      "@context": "http://schema.org",
      "@type": "Person",
      "name": "David Jones",
      "url": "https://www.bladefirelight.com",
      "sameAs": null
    }
  </script>



  <meta name="google-site-verification" content="google6494e52e0a9f7679" />


  <meta name="msvalidate.01" content="FF7ECBA8DC3257F544706CFDE304E3B9">




<!-- end _includes/seo.html -->


<link href="/feed.xml" type="application/atom+xml" rel="alternate" title="PowerShell Journey Feed">

<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">

<!--[if lte IE 9]>
  <style>
    /* old IE unsupported flexbox fixes */
    .greedy-nav .site-title {
      padding-right: 3em;
    }
    .greedy-nav button {
      position: absolute;
      top: 0;
      right: 0;
      height: 100%;
    }
  </style>
<![endif]-->


    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->

<!-- end custom head snippets -->

  </head>

  <body class="layout--single wide">

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    <div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        <a class="site-title" href="/">PowerShell Journey</a>
        <ul class="visible-links">
          
            
            <li class="masthead__menu-item">
              <a href="https://www.bladefirelight.com/nuggets/" >Nuggets</a>
            </li>
          
            
            <li class="masthead__menu-item">
              <a href="https://www.bladefirelight.com/windowsimagetools/" >Windows Image Tools</a>
            </li>
          
            
            <li class="masthead__menu-item">
              <a href="https://www.bladefirelight.com/XcomUtil/" >XcomUtil</a>
            </li>
          
            
            <li class="masthead__menu-item">
              <a href="https://www.bladefirelight.com/year-archive/" >Archive by Date</a>
            </li>
          
            
            <li class="masthead__menu-item">
              <a href="https://www.bladefirelight.com/categories/" >By Category</a>
            </li>
          
            
            <li class="masthead__menu-item">
              <a href="https://www.bladefirelight.com/tags/" >By Tag</a>
            </li>
          
        </ul>
        
        <button class="search__toggle" type="button">
          <svg class="icon" width="16" height="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 15.99 16">
            <path d="M15.5,13.12L13.19,10.8a1.69,1.69,0,0,0-1.28-.55l-0.06-.06A6.5,6.5,0,0,0,5.77,0,6.5,6.5,0,0,0,2.46,11.59a6.47,6.47,0,0,0,7.74.26l0.05,0.05a1.65,1.65,0,0,0,.5,1.24l2.38,2.38A1.68,1.68,0,0,0,15.5,13.12ZM6.4,2A4.41,4.41,0,1,1,2,6.4,4.43,4.43,0,0,1,6.4,2Z" transform="translate(-.01)"></path>
          </svg>
        </button>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle Menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>

    <div class="initial-content">
      


  
    



<nav class="breadcrumbs">
  <ol itemscope itemtype="http://schema.org/BreadcrumbList">
    
    
    
      
        <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
          <a href="https://www.bladefirelight.com/" itemprop="item"><span itemprop="name">Home</span></a>
          <meta itemprop="position" content="1" />
        </li>
        <span class="sep">/</span>
      
      
        
        <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
          <a href="/categories/nuggets" itemprop="item"><span itemprop="name">Nuggets</span></a>
          <meta itemprop="position" content="2" />
        </li>
        <span class="sep">/</span>
      
    
      
      
        <li class="current">Collecting CA Certificates for DSC Configuration</li>
      
    
  </ol>
</nav>

  


<div id="main" role="main">
  
  <div class="sidebar sticky">
  


<div itemscope itemtype="http://schema.org/Person">

  
    <div class="author__avatar">
      

      
        <img src="/assets/images/avatar1.jpg" alt="David Jones" itemprop="image">
      
    </div>
  

  <div class="author__content">
    
      <h3 class="author__name" itemprop="name">David Jones</h3>
    
    
      <p class="author__bio" itemprop="description">
        20 years IT Pro. Life long student of tech
      </p>
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      
        <li itemprop="homeLocation" itemscope itemtype="http://schema.org/Place">
          <i class="fas fa-fw fa-map-marker-alt" aria-hidden="true"></i> <span itemprop="name">Gretna, NE</span>
        </li>
      

      

      
        <li>
          <a href="mailto:BladeFireLight@outlook.com">
            <meta itemprop="email" content="BladeFireLight@outlook.com" />
            <i class="fas fa-fw fa-envelope-square" aria-hidden="true"></i> Email
          </a>
        </li>
      

      

      
        <li>
          <a href="https://twitter.com/BladeFireLight" itemprop="sameAs">
            <i class="fab fa-fw fa-twitter-square" aria-hidden="true"></i> Twitter
          </a>
        </li>
      

      

      

      

      

      

      

      

      
        <li>
          <a href="https://github.com/BladeFireLight" itemprop="sameAs">
            <i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub
          </a>
        </li>
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>

  
  </div>


  <article class="page" itemscope itemtype="http://schema.org/CreativeWork">
    <meta itemprop="headline" content="Collecting CA Certificates for DSC Configuration">
    <meta itemprop="description" content="Best practice is to use individual certificates for each Node for DSC. While you can use auto enrollment, getting the certificates to where the MOF are build can be a problem. This is one solution">
    <meta itemprop="datePublished" content="April 21, 2017">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title" itemprop="headline">Collecting CA Certificates for DSC Configuration
</h1>
          
            <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  4 minute read
</p>
          
        </header>
      

      <section class="page__content" itemprop="text">
        
          <aside class="sidebar__right ">
            <nav class="toc">
              <header><h4 class="nav__title"><i class="fas fa-file-alt"></i> On This Page</h4></header>
              <ul class="toc__menu">
  <li><a href="#the-goal">The Goal</a></li>
  <li><a href="#pre-requisites">Pre-requisites</a></li>
  <li><a href="#demo">Demo</a></li>
</ul>
            </nav>
          </aside>
        
        <h2 id="the-goal">The Goal</h2>

<p>Microsoft PFE Ashely McGlone <a href="https://blogs.msdn.microsoft.com/powershell/2015/10/01/powershell-dsc-faq-sorting-out-certificates/">recommends</a> that each node managed by DSC (Desired State Configuration) have unique certificate for protecting credentials.</p>

<p><img src="https://www.bladefirelight.com/assets/images/MofCredSecurity.png" alt="Mof Credential Security Chart" /></p>

<p class="notice--info">Starting in WMF 5.0 .MOF are <a href="https://msdn.microsoft.com/en-us/powershell/wmf/5.0/dsc_encryptedmof">encrypted at rest</a> on the Node. But that is not the case for the file on the pull server. So I’m going on the assumption that this is still a best practice.</p>

<p>The problem with that is getting the certificates either from the node or from a CA (Certificate Authority) to the DSC development workstation or CI/CD (Continuous Integration/Continuous Deployment) server. I’m going to cover one method.</p>

<h2 id="pre-requisites">Pre-requisites</h2>

<p>For this I’m going to be using <a href="https://github.com/theJasonHelmick/PS-AutoLab-Env">PowerShell Automated Lab Environment</a> and it’s Configuration called “devops-powershell-fundamentals”</p>

<p>This will generate the following:</p>

<ol>
  <li>DC1 - Domain Controller and Certificate Authority</li>
  <li>S1, S2 - Member servers</li>
  <li>N1 - Nano server (not used)</li>
  <li>Cli1 - Windows 10 workstation</li>
  <li>NAT virtual switch and static IP’s</li>
  <li>Certificate Template called “DSC Template”</li>
  <li>Auto-Enrollment GPO</li>
</ol>

<p>Once that is up and running we can connect to cli1 via PowerShell Direct</p>

<h2 id="demo">Demo</h2>

<p>I’m going to start with installing PKITools from the PowerShell Gallery  (and selecting Yes to install NuGet and allow use of untrusted rpo, this is new lab after all)</p>

<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Install-Module PKITools
Get-Command -Module PkiTools

CommandType     Name                                               Version    Source
-----------     ----                                               -------    ------
<span class="k">Function        </span>Get-ADCertificateTemplate                          1.6        PkiTools
<span class="k">Function        </span>Get-CaLocationString                               1.6        PkiTools
<span class="k">Function        </span>Get-CertificatAuthority                            1.6        PkiTools
<span class="k">Function        </span>Get-CertificateTemplateOID                         1.6        PkiTools
<span class="k">Function        </span>Get-IssuedCertificate                              1.6        PkiTools
</code></pre></div></div>

<p>The one I want to focus on is Get-IssuedCertificate. As part of a DSC build process I want to collect the public certificates for each node. Pulling the certificate from each node is one option, but not practical in large network, and may not even be be possible due to lack of connectivity. Thankfully all the public certificates also reside on the Certificate Authority that issues them.</p>

<p>In our lab there is only one domain and one CA (also the DC. no not do that in production) So the code will be simple.</p>

<p>First lets look at the parameters.</p>

<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>SYNTAX
    Get-IssuedCertificate <span class="o">[[</span>-ExpireInDays] &lt;Int32&gt;] <span class="o">[[</span>-CAlocation] &lt;<span class="kt">String</span><span class="o">[]&gt;]</span> <span class="o">[[</span>-Properties] &lt;<span class="kt">String</span><span class="o">[]&gt;]</span>
    <span class="o">[[</span>-CertificateTemplateOid] &lt;<span class="kt">String</span><span class="o">&gt;]</span> <span class="o">[[</span>-CommonName] &lt;<span class="kt">String</span><span class="o">&gt;]</span> <span class="o">[[</span>-Credential] &lt;PSCredential&gt;] <span class="o">[</span>&lt;CommonParameters&gt;]
</code></pre></div></div>

<p>No parameters are required. lets see what it does</p>

<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>hv01]: <span class="o">[</span>Cli1]: <span class="nb">PS </span>C:\&gt; Get-IssuedCertificate


Issued Common Name          :
Certificate Expiration Date : 4/18/2018 3:40:05 AM
Certificate Effective Date  : 4/18/2017 3:40:05 AM
Certificate Template        : 1.3.6.1.4.1.311.21.8.8376484.9891361.12404633.14452813.1016466.111.1.29
Issued Request ID           : 2
Certificate Hash            : f2 4e db 00 12 19 68 79 98 0b 6a 95 47 6d 7a c6 a7 40 e7 63
Request Disposition Message : Issued
Requester Name              : COMPANY\DC1<span class="err">$</span>
Binary Certificate          : -----BEGIN CERTIFICATE-----
                              MIIF6jCCBNKgAwIBAgITUQAAAAL5xXyLo72OVAAAAAAAAjANBgkqhkiG9w0BAQsF
                              ADBZMRAwDgYDVQQKEwdDb21wYW55MRAwDgYDVQQIEwdBcml6b25hMRAwDgYDVQQH
                              EwdQaG9lbml4MQswCQYDVQQGEwJVUzEUMBIGA1UEAxMLQ29tcGFueS5QcmkwHhcN
                              MTcwNDE4MDM0MDA1WhcNMTgwNDE4MDM0MDA1WjAAMIIBIjANBgkqhkiG9w0BAQEF
                              AAOCAQ8AMIIBCgKCAQEAxjtOVDCixBoUEOWG1WKwPqw0DY77upmE0E4Bfc6CV94g
                              X5ewYtagk7f8KvfigDaoq20qCNzFfaBprseL/0JoKPBY05Ws9O98pfAP639MGP6U
                              MCbgXZ8ILhtoWZCqHi+S8UVyu7D2meyyl54IgeoVcb0MBISWoGyyJ5tzAWYX1XQL
                              /0tnQ4YoWRcJulW7Qvn0kUhk6ooe9Mot4gCD0jPE/QjJ/loJDHO+aCRxsMwEil87
                              KqGKfEcS54dV+g6wRhgxlrfi8b1NDwhKcpgglSzhtmBEUY72m1S5AxuL7V90ZxNU
                              NQ/CBboy98NKri8RbmyvypAQ47MMyadVVmPLsAgGJwIDAQABo4IDAjCCAv4wNgYJ
                              KwYBBAGCNxUHBCkwJwYfKwYBBAGCNxUIg/+hJITb3CGF9Y8ZhvKQTb6FEm8BHQIB
                              cwIBADAUBgNVHSUEDTALBgkrBgEEAYI3FRMwDgYDVR0PAQH/BAQDAgWgMBwGCSsG
                              AQQBgjcVCgQPMA0wCwYJKwYBBAGCNxUTMHgGCSqGSIb3DQEJDwRrMGkwDgYIKoZI
                              hvcNAwICAgCAMA4GCCqGSIb3DQMEAgIAgDALBglghkgBZQMEASowCwYJYIZIAWUD
                              BAEtMAsGCWCGSAFlAwQBAjALBglghkgBZQMEAQUwBwYFKw4DAgcwCgYIKoZIhvcN
                              AwcwHQYDVR0OBBYEFOB1zbkBT8m9NW7DRh7xW13OjSmLMB8GA1UdIwQYMBaAFA+9
                              p4ww6yyPs/vD4ugUNRM24pWIMIHFBgNVHR8Egb0wgbowgbeggbSggbGGga5sZGFw
                              Oi8vL0NOPUNvbXBhbnkuUHJpLENOPURDMSxDTj1DRFAsQ049UHVibGljJTIwS2V5
                              JTIwU2VydmljZXMsQ049U2VydmljZXMsQ049Q29uZmlndXJhdGlvbixEQz1Db21w
                              YW55LERDPVByaT9jZXJ0aWZpY2F0ZVJldm9jYXRpb25MaXN0P2Jhc2U/b2JqZWN0
                              Q2xhc3M9Y1JMRGlzdHJpYnV0aW9uUG9pbnQwgb0GCCsGAQUFBwEBBIGwMIGtMIGq
                              BggrBgEFBQcwAoaBnWxkYXA6Ly8vQ049Q29tcGFueS5QcmksQ049QUlBLENOPVB1
                              YmxpYyUyMEtleSUyMFNlcnZpY2VzLENOPVNlcnZpY2VzLENOPUNvbmZpZ3VyYXRp
                              b24sREM9Q29tcGFueSxEQz1Qcmk/Y0FDZXJ0aWZpY2F0ZT9iYXNlP29iamVjdENs
                              YXNzPWNlcnRpZmljYXRpb25BdXRob3JpdHkwPgYDVR0RAQH/BDQwMqAfBgkrBgEE
                              AYI3GQGgEgQQezARELeYdUOiN2P2QTxNl4IPREMxLkNvbXBhbnkuUHJpMA0GCSqG
                              SIb3DQEBCwUAA4IBAQBCV12I9eIaFLRFsgzbhMizfufvtCOI/EKAOsEYCxI9HFKJ
                              H2HfC0lh7eEZABFQKPNx8XgCHCm5skzdR5oHLbtTwrnky2YJkFnuNOgTF/tuunoU
                              p3+X0Kk3YH88wrv+YPE37PtqF/fJnZvEUzPfxRiaiOFaTisEIXfAxTvVYVBSwK9H
                              oSgH5GTEblvlmiw6LD7JZYqrmYFCPQdB/mj+aOPjyeFClneGH2u8sxKCZHiJ/RWX
                              wQJn8DO5ACctnLC8mH70HR5vVRJ0yFX6vrpnRyJEBSpawAYFK1vPf7Wks+gLSw4q
                              g7ASEJG/MJK0oJpBosOKKGr+jMnEx6BTs1NJ3d0l
                              -----END CERTIFICATE-----

PSComputerName              : DC1.Company.Pri
RunspaceId                  : 146e5d7a-b85a-4540-9360-fea7413a9978

Issued Common Name          :
Certificate Expiration Date : 4/18/2018 3:40:07 AM
Certificate Effective Date  : 4/18/2017 3:40:07 AM
Certificate Template        : 1.3.6.1.4.1.311.21.8.8376484.9891361.12404633.14452813.1016466.111.1.28

~~~~~~~~SNIP~~~~~~~~~~~~~

                              BgkrBgEEAYI3UAEwHQYDVR0OBBYEFKYaQhzh28O8Sy4jBG5/63E59OzBMB8GA1Ud
                              IwQYMBaAFA+9p4ww6yyPs/vD4ugUNRM24pWIMIHFBgNVHR8Egb0wgbowgbeggbSg
                              gbGGga5sZGFwOi8vL0NOPUNvbXBhbnkuUHJpLENOPURDMSxDTj1DRFAsQ049UHVi
                              bGljJTIwS2V5JTIwU2VydmljZXMsQ049U2VydmljZXMsQ049Q29uZmlndXJhdGlv
                              bixEQz1Db21wYW55LERDPVByaT9jZXJ0aWZpY2F0ZVJldm9jYXRpb25MaXN0P2Jh
                              c2U/b2JqZWN0Q2xhc3M9Y1JMRGlzdHJpYnV0aW9uUG9pbnQwgb0GCCsGAQUFBwEB
                              BIGwMIGtMIGqBggrBgEFBQcwAoaBnWxkYXA6Ly8vQ049Q29tcGFueS5QcmksQ049
                              QUlBLENOPVB1YmxpYyUyMEtleSUyMFNlcnZpY2VzLENOPVNlcnZpY2VzLENOPUNv
                              bmZpZ3VyYXRpb24sREM9Q29tcGFueSxEQz1Qcmk/Y0FDZXJ0aWZpY2F0ZT9iYXNl
                              P29iamVjdENsYXNzPWNlcnRpZmljYXRpb25BdXRob3JpdHkwGwYDVR0RBBQwEoIQ
                              Q2xpMS5Db21wYW55LlByaTANBgkqhkiG9w0BAQsFAAOCAQEAFt8fD8dq7WdYxldl
                              648SS8KkqEeqUv4cBXt5/GBLBO/Cr7JB1m5K8U3VrjzwMgyU4n01h0xeJxYeHIvA
                              WZ1Fy8BXSzurH3MOcbC0jKuqezzXAJIpVAfkHB0UBKx+OnZes21aGXjb0ZHTv+lv
                              3lx6Wrc051RD+eDDLz0/+kLU6MRgJHTO8qlgRDRjRSqU7dcU1TKFmpij1IzWjvJb
                              GU2qHCfAnhWr8b+lMjvRMXkBxQjRF9kmMdhQxhR+nWN0/056wpr7/bukwGzPBKAU
                              HfFNFXqNT8nc79rB7IW4T6xZteEm0zG/TTNpIjL74/MGDBzFG3MTDE3i6ks9DoF/
                              <span class="nv">9XDyDg</span><span class="o">==</span>
                              -----END CERTIFICATE-----

PSComputerName              : DC1.Company.Pri
RunspaceId                  : 146e5d7a-b85a-4540-9360-fea7413a9978
</code></pre></div></div>

<p>That got every issued certificate for every CA on the current domain. More then I need. Obviously we need to trim that down to just the DSC certificates. for that we will need to specify -CertificateTemplateOID. Lets look at the help for that parameter.</p>

<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>hv01]: <span class="o">[</span>Cli1]: <span class="nb">PS </span>C:\&gt; <span class="nb">help </span>Get-IssuedCertificate -Parameter CertificateTemplateOid

-CertificateTemplateOid &lt;<span class="kt">String</span><span class="o">&gt;</span>
    <span class="k">Filter </span>on Certificate Template OID <span class="o">(</span>use Get-CertificateTemplateOID<span class="o">)</span>

    Required?                    <span class="nb">false
    </span>Position?                    4
    Default value
    Accept pipeline input?       <span class="nb">false
    </span>Accept wildcard characters?  <span class="nb">false</span>
</code></pre></div></div>

<p>Good it has a function to get the OID lets look at that.</p>

<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>SYNTAX
    Get-CertificateTemplateOID <span class="o">[</span>-Name] &lt;<span class="kt">String</span><span class="o">&gt;</span> <span class="o">[[</span>-Domain] &lt;<span class="kt">String</span><span class="o">&gt;]</span> <span class="o">[</span>-WhatIf] <span class="o">[</span>-Confirm] <span class="o">[</span>&lt;CommonParameters&gt;]
</code></pre></div></div>

<p>Only the -Name is required. That I know.</p>

<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>hv01]: <span class="o">[</span>Cli1]: <span class="nb">PS </span>C:\&gt; Get-CertificateTemplateOID DSCTemplate
1.3.6.1.4.1.311.21.8.16187918.14945684.15749023.11519519.4925321.197.13392998.8282280
</code></pre></div></div>

<p>And I though GUIDS were an eye full.</p>

<p>Get-IssuedCertificate also has a -Propterties paramaters lets look at that.</p>

<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>hv01]: <span class="o">[</span>Cli1]: <span class="nb">PS </span>C:\&gt; <span class="nb">help </span>Get-IssuedCertificate -Parameter Properties

-Properties &lt;<span class="kt">String</span><span class="o">[]&gt;</span>
    Fields <span class="k">in </span>the Certificate Authority Database to Export

    Required?                    <span class="nb">false
    </span>Position?                    3
    Default value                <span class="o">(</span>
                <span class="s1">'Issued Common Name'</span>,
                <span class="s1">'Certificate Expiration Date'</span>,
                <span class="s1">'Certificate Effective Date'</span>,
                <span class="s1">'Certificate Template'</span>,
                <span class="c1">#'Issued Email Address',</span>
                <span class="s1">'Issued Request ID'</span>,
                <span class="s1">'Certificate Hash'</span>,
                <span class="c1">#'Request Disposition',</span>
                <span class="s1">'Request Disposition Message'</span>,
                <span class="s1">'Requester Name'</span>,
            <span class="s1">'Binary Certificate'</span> <span class="o">)</span>
    Accept pipeline input?       <span class="nb">false
    </span>Accept wildcard characters?  <span class="nb">false</span>
</code></pre></div></div>

<p>For collecting the Certificates I only need the ‘Issued Common Name’ and ‘Binary Certificate’</p>

<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>hv01]: <span class="o">[</span>Cli1]: <span class="nb">PS </span>C:\&gt; <span class="nv">$DSCCerts</span> <span class="o">=</span> Get-IssuedCertificate -CertificateTemplateOid <span class="o">(</span>Get-CertificateTemplateOID -Name <span class="s1">'DSC
Template'</span><span class="o">)</span> -Properties <span class="s1">'Issued Common Name'</span>, <span class="s1">'Binary Certificate'</span>
<span class="o">[</span>hv01]: <span class="o">[</span>Cli1]: <span class="nb">PS </span>C:\&gt;
<span class="o">[</span>hv01]: <span class="o">[</span>Cli1]: <span class="nb">PS </span>C:\&gt; <span class="nv">$DSCCerts</span>.Count
4
</code></pre></div></div>

<p>So that got me 4 certs. Now I can step through each one and save them.</p>

<div class="language-powershell pre-wrap highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>hv01]: <span class="o">[</span>Cli1]: <span class="nb">PS </span>C:\&gt; <span class="nb">mkdir </span>c:\certs


    Directory: C:\


Mode                LastWriteTime         Length Name
----                -------------         ------ ----
d-----        4/21/2017   7:12 AM                certs


<span class="o">[</span>hv01]: <span class="o">[</span>Cli1]: <span class="nb">PS </span>C:\&gt; <span class="k">foreach</span> <span class="o">(</span><span class="nv">$cert</span> <span class="k">in</span> <span class="nv">$DSCCerts</span><span class="o">)</span>
<span class="o">&gt;&gt;</span> <span class="o">{</span>
<span class="o">&gt;&gt;</span>     <span class="nb">set-content</span> -path <span class="s2">"c:\certs\</span><span class="k">$(</span><span class="nv">$cert</span>.<span class="s1">'Issued Common Name'</span><span class="k">)</span><span class="s2">.cer"</span> -Value <span class="nv">$cert</span>.<span class="s1">'Binary Certificate'</span> -Encoding Ascii
<span class="o">&gt;&gt;</span> <span class="o">}</span>
<span class="o">[</span>hv01]: <span class="o">[</span>Cli1]: <span class="nb">PS </span>C:\&gt; <span class="nb">dir </span>c:\certs


    Directory: C:\certs


Mode                LastWriteTime         Length Name
----                -------------         ------ ----
-a----        4/21/2017   7:12 AM           1982 Cli1.Company.Pri.cer
-a----        4/21/2017   7:12 AM           1978 DC1.Company.Pri.cer
-a----        4/21/2017   7:12 AM           1972 S1.Company.Pri.cer
-a----        4/21/2017   7:12 AM           1972 S2.Company.Pri.cer
</code></pre></div></div>

<p>Now I have the certificate files for each node I can use for DSC.</p>

        
      </section>

      <footer class="page__meta">
        
        
  


  
  
  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-tags" aria-hidden="true"></i> Tags: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="/tags/dsc" class="page__taxonomy-item" rel="tag">DSC</a><span class="sep">, </span>
    
      
      
      <a href="/tags/pki" class="page__taxonomy-item" rel="tag">PKI</a>
    
    </span>
  </p>




  


  
  
  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-folder-open" aria-hidden="true"></i> Categories: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="/categories/nuggets" class="page__taxonomy-item" rel="tag">Nuggets</a>
    
    </span>
  </p>


        
          <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time datetime="2017-04-21T00:00:00-05:00">April 21, 2017</time></p>
        
      </footer>

      <section class="page__share">
  
    <h4 class="page__share-title">Share on</h4>
  

  <a href="https://twitter.com/intent/tweet?via=BladeFireLight&text=Collecting+CA+Certificates+for+DSC+Configuration%20https%3A%2F%2Fwww.bladefirelight.com%2Fnuggets%2Fcollecting-ca-certificates-for-dsc-configuration%2F" class="btn btn--twitter" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Twitter"><i class="fab fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a>

  <a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fwww.bladefirelight.com%2Fnuggets%2Fcollecting-ca-certificates-for-dsc-configuration%2F" class="btn btn--facebook" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Facebook"><i class="fab fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a>

  <a href="https://plus.google.com/share?url=https%3A%2F%2Fwww.bladefirelight.com%2Fnuggets%2Fcollecting-ca-certificates-for-dsc-configuration%2F" class="btn btn--google-plus" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Google Plus"><i class="fab fa-fw fa-google-plus" aria-hidden="true"></i><span> Google+</span></a>

  <a href="https://www.linkedin.com/shareArticle?mini=true&url=https%3A%2F%2Fwww.bladefirelight.com%2Fnuggets%2Fcollecting-ca-certificates-for-dsc-configuration%2F" class="btn btn--linkedin" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on LinkedIn"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span> LinkedIn</span></a>
</section>


      
  <nav class="pagination">
    
      <a href="/windowsimagetools/Creating-an-Updateed-Image-Part3-Updates/" class="pagination--pager" title="Windows Image Tools | Creating an Updated Image Part 3
">Previous</a>
    
    
      <a href="#" class="pagination--pager disabled">Next</a>
    
  </nav>

    </div>

    
      <div class="page__comments">
  
  
      <section id="static-comments">
        
          <!-- Start static comments -->
          <div class="js-comments">
            
              <h4 class="page__comments-title">Comments</h4>
              

              
                
                
                
                
                
                <article id="comment1" class="js-comment comment" itemprop="comment" itemscope itemtype="http://schema.org/Comment">
  <div class="comment__avatar-wrapper">
    <img class="comment__avatar" src="https://www.gravatar.com/avatar/78d3221a06e75fb07fad1c97949c3740?d=mm&s=80" alt="Missy Januszko">
  </div>
  <div class="comment__content-wrapper">
    <h3 class="comment__author" itemprop="author" itemscope itemtype="http://schema.org/Person">
      
        <span itemprop="name">Missy Januszko</span>
      
    </h3>
    <p class="comment__date">
      
        <a href="#comment1" itemprop="url">
        <time datetime="2017-04-21T18:38:09-05:00" itemprop="datePublished">April 21, 2017 at 11:38 PM</time>
        </a>
      
    </p>
    <div itemprop="text"><p>This is really cool!!</p>
</div>
  </div>
</article>

              
            
          </div>
          <!-- End static comments -->

          <!-- Start new comment form -->
          <div class="page__comments-form">
            <h4 class="page__comments-title">Leave a Comment</h4>
            <p class="small">Your email address will not be published. Required fields are marked <span class="required">*</span></p>
            <form id="new_comment" class="page__comments-form js-form form" method="post" action="https://api.staticman.net/v2/entry/bladefirelight/blog_source/master/comments">
              <div class="form__spinner">
                <i class="fas fa-spinner fa-spin fa-3x fa-fw"></i>
                <span class="sr-only">Loading...</span>
              </div>

              <div class="form-group">
                <label for="comment-form-message">Comment <small class="required">*</small></label>
                <textarea type="text" rows="3" id="comment-form-message" name="fields[message]" tabindex="1"></textarea>
                <div class="small help-block"><a href="https://daringfireball.net/projects/markdown/">Markdown is supported.</a></div>
              </div>
              <div class="form-group">
                <label for="comment-form-name">Name <small class="required">*</small></label>
                <input type="text" id="comment-form-name" name="fields[name]" tabindex="2" />
              </div>
              <div class="form-group">
                <label for="comment-form-email">Email address <small class="required">*</small></label>
                <input type="email" id="comment-form-email" name="fields[email]" tabindex="3" />
              </div>
              <div class="form-group">
                <label for="comment-form-url">Website (optional)</label>
                <input type="url" id="comment-form-url" name="fields[url]" tabindex="4"/>
              </div>
              <div class="form-group hidden" style="display: none;">
                <input type="hidden" name="options[slug]" value="collecting-ca-certificates-for-dsc-configuration">
                <label for="comment-form-location">Not used. Leave blank if you are a human.</label>
                <input type="text" id="comment-form-location" name="fields[hidden]" autocomplete="off"/>
                
                
              </div>
              <!-- Start comment form alert messaging -->
              <p class="hidden js-notice">
                <strong class="js-notice-text"></strong>
              </p>
              <!-- End comment form alert messaging -->
              
              <div class="form-group">
                <button type="submit" id="comment-form-submit" tabindex="5" class="btn btn--primary btn--large">Submit Comment</button>
              </div>
            </form>
          </div>
          <!-- End new comment form -->
          
        
      </section>
    
</div>
    
  </article>

  
  
    <div class="page__related">
      <h4 class="page__related-title">You May Also Enjoy</h4>
      <div class="grid__wrapper">
        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="http://schema.org/CreativeWork">
    
      <div class="archive__item-teaser">
        <img src=
          
            "/assets/images/default-teaser.png"
          
          alt="">
      </div>
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/windowsimagetools/Creating-an-Updateed-Image-Part3-Updates/" rel="permalink">Windows Image Tools | Creating an Updated Image Part 3
</a>
      
    </h2>
    
      <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  5 minute read
</p>
    
    <p class="archive__item-excerpt" itemprop="description">One of the time consuming steps to deploying new VMs is the time spend managing Images and and applying patches. I’m not big on Golden images. I tend to use ...</p>
  </article>
</div>
        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="http://schema.org/CreativeWork">
    
      <div class="archive__item-teaser">
        <img src=
          
            "/assets/images/default-teaser.png"
          
          alt="">
      </div>
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/windowsimagetools/Creating-an-Updateed-Image-Part2-WMF5/" rel="permalink">Windows Image Tools | Creating an Updated Image Part 2
</a>
      
    </h2>
    
      <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  6 minute read
</p>
    
    <p class="archive__item-excerpt" itemprop="description">One of the time consuming steps to deploying new VMs is the time spend managing Images and and applying patches. I’m not big on Golden images. I tend to use ...</p>
  </article>
</div>
        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="http://schema.org/CreativeWork">
    
      <div class="archive__item-teaser">
        <img src=
          
            "/assets/images/default-teaser.png"
          
          alt="">
      </div>
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/windowsimagetools/Creating-an-Updateed-Image-Part1-Base-VHDX/" rel="permalink">Windows Image Tools | Creating an Updated Image Part 1
</a>
      
    </h2>
    
      <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  2 minute read
</p>
    
    <p class="archive__item-excerpt" itemprop="description">One of the time consuming steps to deploying new VMs is the time spend managing Images and and applying patches. I’m not big on Golden images. I tend to use ...</p>
  </article>
</div>
        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="http://schema.org/CreativeWork">
    
      <div class="archive__item-teaser">
        <img src=
          
            "/assets/images/default-teaser.png"
          
          alt="">
      </div>
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/Blog-Refactoring/" rel="permalink">Re-factoring the Blog
</a>
      
    </h2>
    
      <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  1 minute read
</p>
    
    <p class="archive__item-excerpt" itemprop="description">Sometimes rebooting fixes everything

After spending month after month on WidnowsImageTools and little else in my free time. My blog has been looking like ab...</p>
  </article>
</div>
        
      </div>
    </div>
  
  
</div>
    </div>

    
      <div class="search-content">
        <div class="search-content__inner-wrap"><div class="search-searchbar"></div>
    <div class="search-hits"></div></div>
      </div>
    

    <div class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    
      <li><strong>Follow:</strong></li>
    
    
      <li><a href="https://twitter.com/BladeFireLight"><i class="fab fa-fw fa-twitter-square" aria-hidden="true"></i> Twitter</a></li>
    
    
    
      <li><a href="https://github.com/BladeFireLight"><i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
    
    
    
    <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2018 David Jones. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>

      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>
  <script src="https://use.fontawesome.com/releases/v5.0.13/js/all.js"></script>


<!-- Including InstantSearch.js library and styling -->
<script src="https://cdn.jsdelivr.net/npm/instantsearch.js@2.3.3/dist/instantsearch.min.js"></script>
<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.3.3/dist/instantsearch.min.css">
<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.3.3/dist/instantsearch-theme-algolia.min.css">

<script>
// Instanciating InstantSearch.js with Algolia credentials
const search = instantsearch({
  appId: 'H9ZC0SHNUQ',
  apiKey: 'b4603a9d806ac4befb326ce1731d101e',
  indexName: 'Blog',
  searchParameters: {
    restrictSearchableAttributes: [
      'title',
      'content'
    ]
  }
});

const hitTemplate = function(hit) {
  const url = hit.url;
  const title = hit._highlightResult.title.value;
  const content = hit._highlightResult.html.value;

  return `
    <div class="list__item">
      <article class="archive__item" itemscope itemtype="http://schema.org/CreativeWork">
        <h2 class="archive__item-title" itemprop="headline"><a href="${url}">${title}</a></h2>
        <div class="archive__item-excerpt" itemprop="description">${content}</div>
      </article>
    </div>
  `;
}

// Adding searchbar and results widgets
search.addWidget(
  instantsearch.widgets.searchBox({
    container: '.search-searchbar',
    
    placeholder: 'Enter your search term...'
  })
);
search.addWidget(
  instantsearch.widgets.hits({
    container: '.search-hits',
    templates: {
      item: hitTemplate
    }
  })
);

// Starting the search
search.start();
</script>





  <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-120545364-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-120545364-1', { 'anonymize_ip': false});
</script>






    
  <script>
    (function ($) {
    var $comments = $('.js-comments');

    $('#new_comment').submit(function () {
      var form = this;

      $(form).addClass('disabled');
      $('#comment-form-submit').html('<i class="fas fa-spinner fa-spin fa-fw"></i> Loading...');

      $.ajax({
        type: $(this).attr('method'),
        url: $(this).attr('action'),
        data: $(this).serialize(),
        contentType: 'application/x-www-form-urlencoded',
        success: function (data) {
          $('#comment-form-submit').html('Submitted');
          $('.page__comments-form .js-notice').removeClass('notice--danger');
          $('.page__comments-form .js-notice').addClass('notice--success');
          showAlert('Thanks for your comment! It will show on the site once it has been approved.');
        },
        error: function (err) {
          console.log(err);
          $('#comment-form-submit').html('Submit Comment');
          $('.page__comments-form .js-notice').removeClass('notice--success');
          $('.page__comments-form .js-notice').addClass('notice--danger');
          showAlert('Sorry, there was an error with your submission. Please make sure all required fields have been completed and try again.');
          $(form).removeClass('disabled');
        }
      });

      return false;
    });

    function showAlert(message) {
      $('.page__comments-form .js-notice').removeClass('hidden');
      $('.page__comments-form .js-notice-text').html(message);
    }
  })(jQuery);
  </script>

  


  </body>
</html>